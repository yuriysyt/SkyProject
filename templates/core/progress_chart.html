{% extends 'core/base.html' %}
{% block content %}
<div class='row'>
    <div class='col-12'>
        <div class='card'>
            <div class='card-header'>
                <h2>Team Progress Chart</h2>
                {% if team %}
                <p class='text-muted'>{{ team.name }} - {{ team.department.name }}</p>
                {% endif %}
            </div>
            <div class='card-body'>
                {% if chart_data %}
                <div id='progressChart' style='height: 400px;'></div>
                {% else %}
                <div class='alert alert-info'>
                    {% if team %}
                    <p>No voting data available for your team yet.</p>
                    {% else %}
                    <p>You are not assigned to a team. Please update your profile to view team progress.</p>
                    {% endif %}
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

{% if chart_data %}
<script src='https://cdn.jsdelivr.net/npm/chart.js'></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const ctx = document.getElementById('progressChart').getContext('2d');
        
        // Prepare data
        const labels = [];
        const greenData = [];
        const amberData = [];
        const redData = [];
        
        {% for data in chart_data %}
        labels.push('{{ data.date }}');
        greenData.push({{ data.green_percent }});
        amberData.push({{ data.amber_percent }});
        redData.push({{ data.red_percent }});
        {% endfor %}
        
        // Create chart
        const chart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [
                    {
                        label: 'Green',
                        data: greenData,
                        backgroundColor: 'rgba(40, 167, 69, 0.2)',
                        borderColor: 'rgba(40, 167, 69, 1)',
                        borderWidth: 2,
                        tension: 0.1
                    },
                    {
                        label: 'Amber',
                        data: amberData,
                        backgroundColor: 'rgba(255, 193, 7, 0.2)',
                        borderColor: 'rgba(255, 193, 7, 1)',
                        borderWidth: 2,
                        tension: 0.1
                    },
                    {
                        label: 'Red',
                        data: redData,
                        backgroundColor: 'rgba(220, 53, 69, 0.2)',
                        borderColor: 'rgba(220, 53, 69, 1)',
                        borderWidth: 2,
                        tension: 0.1
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 100,
                        title: {
                            display: true,
                            text: 'Percentage (%)'
                        }
                    },
                    x: {
                        title: {
                            display: true,
                            text: 'Session Date'
                        }
                    }
                },
                plugins: {
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return context.dataset.label + ': ' + context.raw + '%';
                            }
                        }
                    }
                }
            }
        });
    });
</script>
{% endif %}
{% endblock %}
