{% extends 'core/base.html' %}
{% block content %}
<div class='row justify-content-center'>
    <div class='col-md-8'>
        <div class='card'>
            <div class='card-header d-flex justify-content-between align-items-center'>
                <h2>Profile</h2>
                <a href='{% url 'change_password' %}' class='btn btn-outline-secondary'>Change Password</a>
            </div>
            <div class='card-body'>
                <form method='post' id='profile-form'>
                    {% csrf_token %}
                    
                    <div class='mb-3'>
                        <label for='id_first_name' class='form-label'>First Name</label>
                        <input type='text' class='form-control' id='id_first_name' name='first_name' value='{{ form.first_name.value|default:'' }}'>
                    </div>
                    
                    <div class='mb-3'>
                        <label for='id_last_name' class='form-label'>Last Name</label>
                        <input type='text' class='form-control' id='id_last_name' name='last_name' value='{{ form.last_name.value|default:'' }}'>
                    </div>
                    
                    <div class='mb-3'>
                        <label for='id_email' class='form-label'>Email</label>
                        <input type='email' class='form-control' id='id_email' name='email' value='{{ form.email.value }}' required>
                    </div>
                    
                    <div class='mb-3'>
                        <label for='id_department' class='form-label'>Department</label>
                        <select class='form-select' id='id_department' name='department'>
                            <option value='' selected>---------</option>
                            {% for department in form.department.field.queryset %}
                            <option value='{{ department.id }}' {% if department.id == form.department.value.id %}selected{% endif %}>
                                {{ department.name }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <div class='mb-3'>
                        <label for='id_team' class='form-label'>Team</label>
                        <select class='form-select' id='id_team' name='team'>
                            <option value='' selected>---------</option>
                            {% for team in form.team.field.queryset %}
                            <option value='{{ team.id }}' {% if team.id == form.team.value.id %}selected{% endif %}>
                                {{ team.name }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <button type='submit' class='btn btn-primary'>Update Profile</button>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const departmentSelect = document.getElementById('id_department');
        const teamSelect = document.getElementById('id_team');
        
        departmentSelect.addEventListener('change', function() {
            const departmentId = this.value;
            
            // Clear team selection
            teamSelect.innerHTML = '<option value='' selected>---------</option>';
            
            if (departmentId) {
                fetch('/ajax/load-teams/?department=' + departmentId)
                    .then(response => response.json())
                    .then(data => {
                        data.forEach(team => {
                            const option = document.createElement('option');
                            option.value = team.id;
                            option.textContent = team.name;
                            teamSelect.appendChild(option);
                        });
                    });
            }
        });
    });
</script>
{% endblock %}
