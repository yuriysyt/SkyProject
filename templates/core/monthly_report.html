{% extends 'core/base.html' %}

{% block content %}
<div class='report-container'>
    <h1>Health Check Monthly Report</h1>
    
    <div class='filters'>
        <form method='get'>
            <div class='row'>
                <div class='col-md-3'>
                    <select name='department' class='form-control'>
                        <option value=''>All Departments</option>
                        {% for dept in departments %}
                        <option value='{{ dept.id }}' {% if selected_dept == dept.id %}selected{% endif %}>{{ dept.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class='col-md-3'>
                    <select name='month' class='form-control'>
                        <option value='1' {% if selected_month == '1' %}selected{% endif %}>January</option>
                        <option value='2' {% if selected_month == '2' %}selected{% endif %}>February</option>
                        <option value='3' {% if selected_month == '3' %}selected{% endif %}>March</option>
                        <option value='4' {% if selected_month == '4' %}selected{% endif %}>April</option>
                        <option value='5' {% if selected_month == '5' %}selected{% endif %}>May</option>
                        <option value='6' {% if selected_month == '6' %}selected{% endif %}>June</option>
                        <option value='7' {% if selected_month == '7' %}selected{% endif %}>July</option>
                        <option value='8' {% if selected_month == '8' %}selected{% endif %}>August</option>
                        <option value='9' {% if selected_month == '9' %}selected{% endif %}>September</option>
                        <option value='10' {% if selected_month == '10' %}selected{% endif %}>October</option>
                        <option value='11' {% if selected_month == '11' %}selected{% endif %}>November</option>
                        <option value='12' {% if selected_month == '12' %}selected{% endif %}>December</option>
                    </select>
                </div>
                <div class='col-md-3'>
                    <select name='year' class='form-control'>
                        <option value='2025' {% if selected_year == '2025' %}selected{% endif %}>2025</option>
                        <option value='2024' {% if selected_year == '2024' %}selected{% endif %}>2024</option>
                    </select>
                </div>
                <div class='col-md-3'>
                    <button type='submit' class='btn btn-primary'>Generate Report</button>
                </div>
            </div>
        </form>
    </div>
    
    {% if report_data %}
    <div class='report-summary'>
        <h2>Summary</h2>
        <div class='row'>
            <div class='col-md-4'>
                <div class='card bg-light'>
                    <div class='card-body'>
                        <h3>Average Score</h3>
                        <p class='display-4'>{{ report_data.average_score|floatformat:1 }}</p>
                    </div>
                </div>
            </div>
            <div class='col-md-4'>
                <div class='card bg-light'>
                    <div class='card-body'>
                        <h3>Total Submissions</h3>
                        <p class='display-4'>{{ report_data.total_submissions }}</p>
                    </div>
                </div>
            </div>
            <div class='col-md-4'>
                <div class='card bg-light'>
                    <div class='card-body'>
                        <h3>Completion Rate</h3>
                        <p class='display-4'>{{ report_data.completion_rate|floatformat:0 }}%</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class='report-charts'>
        <div class='row'>
            <div class='col-md-6'>
                <div class='card'>
                    <div class='card-header'>
                        <h3>Score Distribution</h3>
                    </div>
                    <div class='card-body'>
                        <canvas id='scoreDistribution'></canvas>
                    </div>
                </div>
            </div>
            <div class='col-md-6'>
                <div class='card'>
                    <div class='card-header'>
                        <h3>Category Performance</h3>
                    </div>
                    <div class='card-body'>
                        <canvas id='categoryPerformance'></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class='report-details'>
        <h2>Detailed Results</h2>
        <table class='table table-striped'>
            <thead>
                <tr>
                    <th>Category</th>
                    <th>Average Score</th>
                    <th>Submissions</th>
                    <th>Trend</th>
                </tr>
            </thead>
            <tbody>
                {% for category in report_data.categories %}
                <tr>
                    <td>{{ category.name }}</td>
                    <td>{{ category.average_score|floatformat:1 }}</td>
                    <td>{{ category.submissions }}</td>
                    <td>
                        {% if category.trend > 0 %}
                        <span class='text-success'>↑ {{ category.trend|floatformat:1 }}</span>
                        {% elif category.trend < 0 %}
                        <span class='text-danger'>↓ {{ category.trend|abs|floatformat:1 }}</span>
                        {% else %}
                        <span class='text-secondary'>→ 0.0</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class='alert alert-info'>
        Select filters and click Generate Report to view health check data.
    </div>
    {% endif %}
</div>
{% endblock %}

