
{% extends 'core/base.html' %}
{% load crispy_forms_tags %}

{% block content %}
<div class="container max-w-2xl mx-auto py-8">
    <div class="bg-white rounded-xl shadow-lg overflow-hidden">
        <div class="bg-gradient-to-r from-blue-600 to-sky-500 p-6 text-white">
            <h2 class="text-2xl font-bold flex items-center">
                <i class="bi bi-key mr-3"></i> Change Password
            </h2>
        </div>
        
        <div class="p-6">
            <form method="post" id="passwordForm">
                {% csrf_token %}
                
                <div class="space-y-4">
                    {% for field in form %}
                        <div class="form-group">
                            <label for="{{ field.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">{{ field.label }}</label>
                            <div class="relative">
                                <input type="{{ field.field.widget.input_type }}" name="{{ field.name }}" id="{{ field.id_for_label }}" 
                                       class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 {% if field.errors %}border-red-500{% endif %}"
                                       {% if field.field.required %}required{% endif %}>
                                {% if "password" in field.name %}
                                    <button type="button" class="toggle-password absolute right-2 top-2 text-gray-500 hover:text-gray-700" data-target="{{ field.id_for_label }}">
                                        <i class="bi bi-eye"></i>
                                    </button>
                                {% endif %}
                            </div>
                            {% if field.errors %}
                                <p class="mt-1 text-sm text-red-600">{{ field.errors.0 }}</p>
                            {% endif %}
                            {% if field.help_text %}
                                <p class="mt-1 text-xs text-gray-500">{{ field.help_text }}</p>
                            {% endif %}
                        </div>
                    {% endfor %}
                </div>
                
                <div class="flex justify-between space-x-4 mt-8">
                    <a href="{% url 'profile' %}" class="px-6 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors">
                        <i class="bi bi-arrow-left mr-2"></i> Back to Profile
                    </a>
                    <button type="submit" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors shadow-md">
                        <i class="bi bi-check-lg mr-2"></i> Change Password
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Password visibility toggle
        const toggleButtons = document.querySelectorAll('.toggle-password');
        
        toggleButtons.forEach(button => {
            button.addEventListener('click', function() {
                const targetId = this.getAttribute('data-target');
                const targetInput = document.getElementById(targetId);
                const icon = this.querySelector('i');
                
                if (targetInput.type === 'password') {
                    targetInput.type = 'text';
                    icon.classList.remove('bi-eye');
                    icon.classList.add('bi-eye-slash');
                } else {
                    targetInput.type = 'password';
                    icon.classList.remove('bi-eye-slash');
                    icon.classList.add('bi-eye');
                }
            });
        });
        
        // Form validation
        const form = document.getElementById('passwordForm');
        
        form.addEventListener('submit', function(e) {
            const oldPassword = document.getElementById('id_old_password').value;
            const newPassword1 = document.getElementById('id_new_password1').value;
            const newPassword2 = document.getElementById('id_new_password2').value;
            
            if (newPassword1 !== newPassword2) {
                e.preventDefault();
                alert('New passwords do not match.');
            }
            
            if (oldPassword === newPassword1) {
                e.preventDefault();
                alert('New password cannot be the same as the old password.');
            }
        });
    });
</script>
{% endblock %}
